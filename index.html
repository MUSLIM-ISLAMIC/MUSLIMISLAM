<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#02050a">
        <title>MI ORGNIZATION|MUSLIM ISLAM ORG| ISLAMIC PORTAL ORG</title>
    <link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#00ff9d">
<link rel="apple-touch-icon" href="https://i.ibb.co/hxKxjqWk/logo.png">
    <link rel="icon" href="https://i.ibb.co/hxKxjqWk/logo.png" type="image/png">

    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
    
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/particles.js@2.0.0/particles.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>

    <style>
        /* ==========================================================================
           ADVANCED DIGITAL CSS ARCHITECTURE (Fully Responsive)
           ========================================================================== */
        
        :root {
            --bg-deep: #02050a;
            --bg-surface: #0a0f16;
            --primary-glow: #00ff9d;
            --secondary-glow: #00b8ff;
            --admin-gold: #ffd700;
            --glass-light: rgba(255, 255, 255, 0.03);
            --glass-border: rgba(255, 255, 255, 0.08);
            --shadow-cyber: 0 0 20px rgba(0, 255, 157, 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            background-color: var(--bg-deep);
            color: #ffffff;
            font-family: 'Inter', 'Segoe UI', sans-serif;
            overflow-x: hidden;
            width: 100vw;
        }

        /* DIGITAL SCROLLBAR */
        ::-webkit-scrollbar { width: 4px; }
        ::-webkit-scrollbar-track { background: var(--bg-deep); }
        ::-webkit-scrollbar-thumb { background: var(--primary-glow); border-radius: 10px; }

        /* BACKGROUND PARTICLES LAYER */
        #particles-js {
            position: fixed;
            width: 100vw;
            height: 100vh;
            top: 0;
            left: 0;
            z-index: -1;
            background: radial-gradient(circle at center, #0a1118 0%, #02050a 100%);
        }

        /* ==========================================================================
           5-SECOND SECURE SPLASH SCREEN
           ========================================================================== */
        #splash-container {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: #000000;
            z-index: 999999;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            transition: opacity 0.8s ease-in-out, visibility 0.8s ease-in-out;
        }

        .splash-logo {
            width: 120px;
            filter: drop-shadow(0 0 20px var(--primary-glow));
            animation: breathe 2s infinite alternate ease-in-out;
            margin-bottom: 30px;
        }

        @keyframes breathe {
            0% { transform: scale(0.95); filter: drop-shadow(0 0 10px var(--primary-glow)); }
            100% { transform: scale(1.05); filter: drop-shadow(0 0 40px var(--primary-glow)); }
        }

        .cyber-loader {
            width: 200px;
            height: 2px;
            background: rgba(255, 255, 255, 0.1);
            position: relative;
            overflow: hidden;
        }

        .cyber-loader-fill {
            position: absolute;
            top: 0; left: 0; height: 100%;
            background: var(--primary-glow);
            width: 0%;
            /* Strict 5s animation for loader */
            animation: cyber-load 5s cubic-bezier(0.4, 0, 0.2, 1) forwards;
        }

        @keyframes cyber-load {
            0% { width: 0%; box-shadow: 0 0 10px var(--primary-glow); }
            50% { width: 60%; box-shadow: 0 0 20px var(--primary-glow); }
            100% { width: 100%; box-shadow: 0 0 30px var(--primary-glow); }
        }

        .splash-text {
            margin-top: 20px;
            letter-spacing: 4px;
            font-size: 12px;
            text-transform: uppercase;
            color: var(--primary-glow);
            font-family: monospace;
        }

        /* ==========================================================================
           GLASSMORPHISM PANELS & UI
           ========================================================================== */
        .glass-panel {
            background: var(--glass-light);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            box-shadow: var(--shadow-cyber);
            transition: transform 0.3s ease, border-color 0.3s ease;
        }

        .glass-panel:hover {
            border-color: rgba(0, 255, 157, 0.3);
            transform: translateY(-3px);
        }

        .text-gradient {
            background: linear-gradient(135deg, #ffffff 0%, var(--primary-glow) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        /* ==========================================================================
           REAL-TIME CHAT UI ARCHITECTURE
           ========================================================================== */
        .chat-wrapper {
            height: 450px;
            overflow-y: auto;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 15px;
            scroll-behavior: smooth;
        }

        .message-row {
            display: flex;
            flex-direction: column;
            width: 100%;
            animation: fadeIn 0.3s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .message-row.admin-row { align-items: flex-end; }
        .message-row.user-row { align-items: flex-start; }

        .chat-name-tag {
            font-size: 0.7rem;
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            gap: 6px;
            letter-spacing: 0.5px;
        }

        .user-row .chat-name-tag { color: #8892b0; padding-left: 5px; }
        .admin-row .chat-name-tag { color: var(--admin-gold); padding-right: 5px; }

        .chat-bubble {
            max-width: 85%;
            padding: 12px 16px;
            border-radius: 16px;
            font-size: 0.9rem;
            line-height: 1.5;
            word-wrap: break-word;
            position: relative;
        }

        .user-bubble {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-bottom-left-radius: 4px;
            color: #e2e8f0;
        }

        .admin-bubble {
            background: rgba(255, 215, 0, 0.08);
            border: 1px solid rgba(255, 215, 0, 0.5);
            border-bottom-right-radius: 4px;
            color: #ffffff;
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.1);
        }

        .badge-verified {
            background: var(--admin-gold);
            color: #000;
            font-size: 0.55rem;
            font-weight: 900;
            padding: 2px 6px;
            border-radius: 8px;
            text-transform: uppercase;
        }

        /* ==========================================================================
           MOBILE OPTIMIZATION (MEDIA QUERIES)
           ========================================================================== */
        @media screen and (max-width: 768px) {
            .hero-title { font-size: 2.5rem !important; line-height: 1.2 !important; }
            .hero-subtitle { font-size: 0.9rem !important; padding: 0 15px; }
            
            /* Navbar Mobile Fix */
            .nav-container { padding: 15px !important; }
            .nav-links { display: none; }
            
            /* Stats Grid Fix */
            .stats-grid { grid-template-columns: 1fr 1fr !important; gap: 10px !important; }
            .stats-card { padding: 15px !important; }
            .stats-card i { font-size: 1.2rem !important; }
            
            /* Chat Input Stack for Mobile */
            .chat-inputs { flex-direction: column !important; gap: 10px !important; }
            .chat-inputs input { width: 100% !important; }
            .chat-send-btn { width: 100% !important; height: 50px !important; border-radius: 12px !important; }
            
            /* General Spacing */
            section { padding-left: 15px !important; padding-right: 15px !important; }
        }
        /* üéµ FLOATING MUSIC BUTTON STYLES ‚ú® */
.mio-music-btn {
    position: fixed;
    bottom: 30px;
    right: 30px;
    width: 65px;
    height: 65px;
    border-radius: 50%;
    background: rgba(0, 255, 157, 0.1);
    border: 2px solid #00ff9d;
    color: #00ff9d;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 24px;
    cursor: pointer;
    z-index: 99999;
    box-shadow: 0 0 25px rgba(0, 255, 157, 0.3);
    backdrop-filter: blur(10px);
    transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
}

.mio-music-btn:hover {
    transform: scale(1.15) rotate(10deg);
    background: #00ff9d;
    color: #000;
}

.mio-music-btn.is-playing {
    animation: mio-pulse-glow 2s infinite;
}

@keyframes mio-pulse-glow {
    0% { box-shadow: 0 0 0 0 rgba(0, 255, 157, 0.8); }
    70% { box-shadow: 0 0 0 25px rgba(0, 255, 157, 0); }
    100% { box-shadow: 0 0 0 0 rgba(0, 255, 157, 0); }
}

    </style>
</head>
<body>
<div id="update-overlay" class="fixed inset-0 bg-[#05070a]/95 backdrop-blur-xl z-[100000] hidden flex items-center justify-center p-6">
    <div class="max-w-md w-full glass-panel p-8 border border-cyan-500/30 text-center animate__animated animate__zoomIn">
        <div class="w-20 h-20 bg-cyan-500/20 rounded-full flex items-center justify-center mx-auto mb-6 shadow-[0_0_30px_rgba(0,255,157,0.2)]">
            <i class="fas fa-cloud-download-alt text-3-xl text-cyan-400 animate-bounce"></i>
        </div>
        
        <h2 class="text-2xl font-black text-white mb-2 uppercase tracking-tighter">New Update Detected!</h2>
        <p id="update-ver-text" class="text-cyan-400 font-mono text-sm mb-6">Version: 1.0.0</p>
        
        <div class="w-full bg-white/5 rounded-full h-2 mb-4 overflow-hidden">
            <div id="update-progress" class="h-full bg-gradient-to-r from-cyan-500 to-green-500 w-0 transition-all duration-300"></div>
        </div>
        
        <p id="update-status" class="text-gray-400 text-[10px] uppercase tracking-widest mb-6">Initializing Cache Buster...</p>
        
        <button id="update-confirm-btn" class="w-full py-4 bg-cyan-500 text-black font-black rounded-xl hover:bg-cyan-400 transition-all shadow-lg uppercase tracking-widest">
            UPDATE NOW ‚ö°
        </button>
    </div>
</div>

    <div id="particles-js"></div>

    <div id="splash-container">
        <img src="https://i.ibb.co/hxKxjqWk/logo.png" alt="Logo" class="splash-logo">
        <div class="cyber-loader"><div class="cyber-loader-fill"></div></div>
        <div class="splash-text" id="splash-status">Establishing Secure Link...</div>
        <div class="mt-2 text-[9px] text-gray-600 font-mono tracking-widest">AWAITING HANDSHAKE</div>
    </div>

    <nav class="fixed w-full top-0 z-50 p-4 transition-all duration-300" id="navbar">
        <div class="nav-container max-w-7xl mx-auto glass-panel px-6 py-3 flex justify-between items-center">
            <div class="flex items-center gap-3">
                <img src="https://i.ibb.co/hxKxjqWk/logo.png" class="w-10 h-10 hover:rotate-180 transition-transform duration-700" alt="Logo">
                <div>
                    <h1 class="font-black text-lg tracking-wider text-white leading-tight">üÖº.üÖ∏ ùêéùêëùêÜùêçùêàùêôùêÄùêìùêàùêéùêç</h1>
                    <p class="text-[9px] text-green-400 font-mono tracking-widest leading-none mt-1">SECURE NODE</p>
                </div>
            </div>
            
            <div class="nav-links hidden md:flex gap-8 text-xs font-bold tracking-widest text-gray-400">
                <a href="#home" class="hover:text-green-400 transition">HOME</a>
                <a href="#intel" class="hover:text-green-400 transition">INTEL</a>
                <a href="#projects" class="hover:text-green-400 transition">PROJECTS</a>
                <a href="#chat" class="hover:text-green-400 transition">COMMUNITY</a>
            </div>

            <div class="flex items-center gap-2 bg-black/50 px-3 py-1.5 rounded-full border border-white/5">
                <div class="w-1.5 h-1.5 bg-red-500 rounded-full animate-ping"></div>
                <span class="text-[10px] font-mono text-gray-400">VIEWS: <span id="nav-live-views" class="text-green-400 font-bold">0000</span></span>
            </div>
        </div>
    </nav>

    <section id="home" class="min-h-screen flex flex-col justify-center items-center text-center pt-24 relative z-10">
        <div data-aos="zoom-in" data-aos-duration="1500">
            <h2 class="hero-title text-5xl md:text-7xl font-black mb-6 tracking-tighter">
                THE NEXT-GEN <br> 
                <span class="text-gradient">ISLAMIC NETWORK</span>
            </h2>
            <p class="hero-subtitle text-gray-400 max-w-2xl mx-auto text-sm md:text-base mb-10 leading-relaxed px-4">
                A mi fully synchronized digital infrastructure connecting global members through real-time encrypted data, high-fidelity UI, and seamless tracking.
            </p>
            <audio id="portal-bg-music" loop preload="auto"></audio>
<audio id="portal-click-sfx" src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_c8c8a73467.mp3?filename=ui-click-43196.mp3" preload="auto"></audio>

<button id="mio-music-toggle" class="mio-music-btn" onclick="togglePortalMusic()" title="Play/Pause Background Music">
    <i class="fas fa-volume-mute" id="mio-music-icon"></i>
</button>            

            <div class="flex flex-wrap justify-center gap-4">
    <a href="javascript:void(0)" 
       onclick="triggerAccessSound('#projects')" 
       class="px-6 py-3 bg-green-500 text-black text-sm font-black rounded-full hover:bg-green-400 transition shadow-[0_0_15px_rgba(0,255,157,0.3)]">
        ACCESS PORTAL
    </a>
</div>

        </div>
    </section>

    <section id="intel" class="py-16 max-w-7xl mx-auto relative z-10">
        <div class="text-center mb-12" data-aos="fade-up">
            <h3 class="text-xs font-mono text-green-400 tracking-[0.2em] mb-2">SYSTEM SCAN</h3>
            <h2 class="text-3xl font-black text-white">DEVICE INTELLIGENCE</h2>
        </div>

        <div class="stats-grid grid grid-cols-2 md:grid-cols-4 gap-4 px-4">
            <div class="stats-card glass-panel p-6 flex flex-col items-center justify-center text-center" data-aos="flip-up" data-aos-delay="100">
                <i class="fas fa-network-wired text-xl text-blue-400 mb-3 opacity-80"></i>
                <p class="text-[9px] text-gray-500 uppercase tracking-widest mb-1">Network IP</p>
                <h4 id="display-ip" class="text-sm font-mono font-bold text-white">Scanning...</h4>
            </div>

            <div class="stats-card glass-panel p-6 flex flex-col items-center justify-center text-center" data-aos="flip-up" data-aos-delay="200">
                <i class="fas fa-satellite-dish text-xl text-green-400 mb-3 opacity-80"></i>
                <p class="text-[9px] text-gray-500 uppercase tracking-widest mb-1">Server Status</p>
                <h4 class="text-sm font-bold text-green-400">Connected</h4>
            </div>

            <div class="stats-card glass-panel p-6 flex flex-col items-center justify-center text-center" data-aos="flip-up" data-aos-delay="300">
                <i class="fas fa-microchip text-xl text-purple-400 mb-3 opacity-80"></i>
                <p class="text-[9px] text-gray-500 uppercase tracking-widest mb-1">System Architecture</p>
                <h4 id="display-os" class="text-sm font-bold text-white">Detecting...</h4>
            </div>

            <div class="stats-card glass-panel p-6 flex flex-col items-center justify-center text-center" data-aos="flip-up" data-aos-delay="400">
                <i class="fas fa-globe text-xl text-yellow-400 mb-3 opacity-80"></i>
                <p class="text-[9px] text-gray-500 uppercase tracking-widest mb-1">Total Network Pings</p>
                <h4 id="display-views" class="text-2xl font-black text-yellow-400">0</h4>
            </div>
        </div>
    </section>

    <section id="projects" class="py-16 max-w-7xl mx-auto relative z-10 px-4">
        <div class="flex flex-col md:flex-row justify-between items-center mb-10" data-aos="fade-right">
            <div class="text-center md:text-left">
                <h3 class="text-xs font-mono text-green-400 tracking-[0.2em] mb-2">LIVE DIRECTORY</h3>
                <h2 class="text-3xl font-black text-white">ORGANIZATION INITIATIVES</h2>
            </div>
        </div>

        <div id="project-render-area" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            <div class="glass-panel p-5 animate-pulse">
                <div class="w-full h-40 bg-white/5 rounded-lg mb-4"></div>
                <div class="h-4 bg-white/10 w-2/3 rounded mb-2"></div>
                <div class="h-3 bg-white/5 w-full rounded"></div>
            </div>
        </div>
    </section>

    <section id="chat" class="py-16 max-w-4xl mx-auto relative z-10 px-4">
        <div class="text-center mb-10" data-aos="fade-up">
            <h2 class="text-3xl font-black text-white">GLOBAL ENCRYPTED CHAT</h2>
            <p class="text-gray-500 mt-2 text-xs">Messages are synced across all active network nodes instantly.</p>
        </div>

        <div class="glass-panel overflow-hidden border border-green-500/20 shadow-[0_0_30px_rgba(0,255,157,0.05)]" data-aos="zoom-in">
            <div class="bg-black/40 border-b border-white/5 p-4 flex justify-between items-center">
                <div class="flex items-center gap-3">
                    <div class="w-8 h-8 rounded-full bg-green-500/10 flex items-center justify-center border border-green-500/30">
                        <i class="fas fa-satellite text-green-400 text-xs"></i>
                    </div>
                    <div>
                        <h4 class="font-bold text-white text-sm">Community Relay</h4>
                        <p class="text-[8px] text-green-400 uppercase tracking-widest">End-to-End Synced</p>
                    </div>
                </div>
            </div>

            <div id="chat-messages-container" class="chat-wrapper bg-[#020408]">
                </div>

            <div class="p-4 bg-black/40 border-t border-white/5">
                <div class="chat-inputs flex gap-3">
                    <div class="relative w-full md:w-1/3">
                        <i class="fas fa-user-secret absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-500 text-xs"></i>
                        <input type="text" id="user-name-input" placeholder="Display Name" class="w-full bg-black/60 border border-white/10 rounded-xl py-3 pl-8 pr-3 text-white text-sm outline-none focus:border-green-500 transition">
                    </div>
                    
                    <div class="relative flex-1 flex gap-2">
                        <input type="text" id="user-msg-input" placeholder="Transmit message..." class="w-full bg-black/60 border border-white/10 rounded-xl py-3 px-4 text-white text-sm outline-none focus:border-green-500 transition" onkeypress="handleEnter(event)">
                        <button onclick="sendUserMessage()" class="chat-send-btn w-14 bg-green-500 text-black flex items-center justify-center rounded-xl hover:bg-green-400 transition shadow-lg active:scale-95">
                            <i class="fas fa-paper-plane"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <footer class="py-8 text-center border-t border-white/5 mt-10 relative z-10 bg-black/30">
        <p class="text-[10px] text-gray-500 font-mono tracking-widest">¬© 2026 M.I.O DIGITAL INFRASTRUCTURE</p>
    </footer>

    <script>
        // --- 1. FIREBASE INITIALIZATION ---
        // Setup configuration object
        const firebaseConfig = {
            apiKey: "AIzaSyBbnU8DkthpYQMHOLLyj6M0cc05qXfjMcw",
            authDomain: "ramadan-2385b.firebaseapp.com",
            databaseURL: "https://ramadan-2385b-default-rtdb.firebaseio.com",
            projectId: "ramadan-2385b",
            storageBucket: "ramadan-2385b.firebasestorage.app",
            messagingSenderId: "882828936310",
            appId: "1:882828936310:web:7f97b921031fe130fe4b57"
        };
        
        // Initialize Firebase securely
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        // --- 2. PARTICLES.JS ENGINE CONFIGURATION ---
        particlesJS("particles-js", {
            "particles": {
                "number": { "value": 60, "density": { "enable": true, "value_area": 800 } },
                "color": { "value": ["#00ff9d", "#00b8ff", "#ffffff"] },
                "shape": { "type": "circle" },
                "opacity": { "value": 0.4, "random": true, "anim": { "enable": true, "speed": 1, "opacity_min": 0.1, "sync": false } },
                "size": { "value": 2, "random": true },
                "line_linked": { "enable": true, "distance": 150, "color": "#ffffff", "opacity": 0.1, "width": 1 },
                "move": { "enable": true, "speed": 1.5, "direction": "none", "random": false, "straight": false, "out_mode": "out" }
            },
            "interactivity": {
                "detect_on": "canvas",
                "events": { "onhover": { "enable": true, "mode": "grab" }, "onclick": { "enable": true, "mode": "push" }, "resize": true },
                "modes": { "grab": { "distance": 140, "line_linked": { "opacity": 0.4 } }, "push": { "particles_nb": 3 } }
            },
            "retina_detect": true
        });

        // --- 3. STRICT 5-SECOND SPLASH SCREEN LOGIC ---
        document.addEventListener("DOMContentLoaded", () => {
            const splash = document.getElementById('splash-container');
            const statusText = document.getElementById('splash-status');
            const body = document.body;
            
            // Lock scrolling
            body.style.overflow = 'hidden';

            // Simulate loading statuses
            setTimeout(() => { statusText.innerText = "Authenticating Node..."; }, 1500);
            setTimeout(() => { statusText.innerText = "Syncing Realtime DB..."; }, 3000);
            setTimeout(() => { statusText.innerText = "System Ready. Initializing UI..."; }, 4200);

            // Exactly 5 seconds timer
            setTimeout(() => {
                splash.style.opacity = '0';
                
                setTimeout(() => {
                    splash.style.display = 'none';
                    body.style.overflow = 'auto';
                    body.style.overflowX = 'hidden';
                    
                    // FIX: Initialize AOS *after* splash screen finishes
                    if(typeof AOS !== 'undefined') {
                        AOS.init({ duration: 1000, once: false, offset: 50 });
                    } else {
                        console.error("AOS Library Failed to Load from CDN");
                    }
                    
                    // Navbar Blur Effect
                    window.addEventListener('scroll', () => {
                        const nav = document.getElementById('navbar');
                        if(window.scrollY > 30) {
                            nav.classList.add('bg-[#02050a]/90', 'backdrop-blur-lg', 'border-b', 'border-white/5');
                        } else {
                            nav.classList.remove('bg-[#02050a]/90', 'backdrop-blur-lg', 'border-b', 'border-white/5');
                        }
                    });

                }, 800); // Wait for CSS opacity transition
            }, 5000);
        });

        // --- 4. ROBUST DEVICE TRACKING & INTEL (FIXED CORS ISSUE) ---
        async function executeSurveillance() {
            // Setup Default/Fallback Values (For offline/local file execution)
            let ipAddress = "Encrypted Local Node";
            
            // Device Detection Logic (Works completely offline without APIs)
            const ua = navigator.userAgent;
            let os = "Unknown OS";
            if (ua.indexOf("Win") !== -1) os = "Windows";
            if (ua.indexOf("Mac") !== -1) os = "MacOS";
            if (ua.indexOf("Linux") !== -1) os = "Linux";
            if (ua.indexOf("Android") !== -1) os = "Android";
            if (ua.indexOf("like Mac") !== -1) os = "iOS";
            
            let deviceType = window.innerWidth <= 768 ? "Mobile" : "Desktop";
            document.getElementById('display-os').innerText = `${os} (${deviceType})`;

            // Attempt IP Fetch with Try-Catch to prevent script breaking on local files (CORS)
            try {
                // Using ipify which is often more lenient, or just failing gracefully
                const response = await fetch('https://api.ipify.org?format=json');
                if(response.ok) {
                    const data = await response.json();
                    ipAddress = data.ip;
                }
            } catch (error) {
                console.warn("Client blocked IP API request (Likely CORS due to local file run). Using secure fallback.");
                // This prevents the scary red error from breaking other JS code.
            }

            document.getElementById('display-ip').innerText = ipAddress;

            // Log securely to Firebase Analytics (Only if we are connected to internet)
            if(navigator.onLine) {
                const logData = {
                    ip: ipAddress,
                    os: os,
                    device: deviceType,
                    timestamp: new Date().toISOString(),
                    origin: window.location.protocol
                };
                // Push quietly
                database.ref('analytics/visitors').push(logData).catch(e => console.log("DB Push Delay"));

                // Sync Live Views Counter
                const viewsRef = database.ref('analytics/global_views');
                viewsRef.transaction((currentViews) => {
                    return (currentViews || 0) + 1;
                });
            }
        }

        // Listen for View Updates
        database.ref('analytics/global_views').on('value', (snapshot) => {
            const views = snapshot.val() || 0;
            const formattedViews = views.toString().padStart(4, '0');
            document.getElementById('nav-live-views').innerText = formattedViews;
            
            if(typeof gsap !== 'undefined') {
                gsap.to('#display-views', { innerHTML: views, duration: 1.5, snap: { innerHTML: 1 } });
            } else {
                document.getElementById('display-views').innerText = views;
            }
        });

        // --- 5. IDENTITY REAL-TIME CHAT ARCHITECTURE ---
        function handleEnter(e) { if (e.key === 'Enter') sendUserMessage(); }

        function sendUserMessage() {
            const nameInput = document.getElementById('user-name-input');
            const msgInput = document.getElementById('user-msg-input');
            
            const name = nameInput.value.trim();
            const message = msgInput.value.trim();

            if (!message) {
                Swal.fire({
                    toast: true, position: 'top', icon: 'warning',
                    title: 'Message field is empty',
                    showConfirmButton: false, timer: 2000,
                    background: '#111', color: '#fff'
                });
                return;
            }

            const payload = {
                senderName: name === "" ? "Unknown Node" : name,
                messageText: message,
                isAdmin: false,
                timestamp: firebase.database.ServerValue.TIMESTAMP
            };

            // Push to Firebase and clear input
            database.ref('system_chat').push(payload).then(() => {
                msgInput.value = ""; 
            });
        }

        // Live Chat Listener
        database.ref('system_chat').limitToLast(50).on('value', (snapshot) => {
            const container = document.getElementById('chat-messages-container');
            container.innerHTML = ''; 
            
            if (!snapshot.exists()) {
                container.innerHTML = `<div class="text-center text-gray-600 mt-10 text-xs">Awaiting first transmission...</div>`;
                return;
            }

            snapshot.forEach((child) => {
                const data = child.val();
                const isAdmin = data.isAdmin === true;
                
                const rowClass = isAdmin ? "admin-row" : "user-row";
                const bubbleClass = isAdmin ? "admin-bubble" : "user-bubble";
                const badgeHTML = isAdmin ? `<span class="badge-verified"><i class="fas fa-check"></i> Verified Admin</span>` : ``;
                
                // Format Timestamp gracefully
                let timeStr = "";
                if(data.timestamp) {
                    const dt = new Date(data.timestamp);
                    timeStr = dt.getHours() + ":" + (dt.getMinutes()<10?'0':'') + dt.getMinutes();
                }

                container.innerHTML += `
                    <div class="message-row ${rowClass}">
                        <div class="chat-name-tag">
                            ${data.senderName} ${badgeHTML}
                        </div>
                        <div class="chat-bubble ${bubbleClass}">
                            ${data.messageText}
                            <div style="font-size: 0.55rem; opacity: 0.5; margin-top: 4px; text-align: right;">${timeStr}</div>
                        </div>
                    </div>
                `;
            });
            
            // Auto-scroll logic
            setTimeout(() => { container.scrollTop = container.scrollHeight; }, 100);
        });

        // --- 6. PROJECTS RENDER MODULE ---
        function initializeProjects() {
            database.ref('organization_projects').on('value', (snapshot) => {
                const renderArea = document.getElementById('project-render-area');
                
                if (!snapshot.exists()) {
                    renderArea.innerHTML = `<div class="col-span-full text-center text-gray-500 p-8 glass-panel text-sm">No initiatives published by Admin yet.</div>`;
                    return;
                }

                renderArea.innerHTML = ''; 
                
                snapshot.forEach((child) => {
                    const p = child.val();
                    const projectId = child.key;
                    const defaultLogo = 'https://via.placeholder.com/400x200/0a0f16/00ff9d?text=Project+Data';
                    
                    renderArea.innerHTML += `
                        <div class="glass-panel p-5 group flex flex-col h-full" data-aos="fade-up">
                            <div class="overflow-hidden rounded-lg mb-4 border border-white/5 relative bg-black/50 aspect-video flex items-center justify-center">
                                <img src="${p.logoLink || defaultLogo}" alt="Project" class="w-full h-full object-cover opacity-80 group-hover:opacity-100 group-hover:scale-105 transition duration-500" onerror="this.src='${defaultLogo}'">
                            </div>
                            
                            <h4 class="text-xl font-bold text-white mb-2 group-hover:text-green-400 transition">${p.title}</h4>
                            <p class="text-xs text-gray-400 mb-5 flex-1 leading-relaxed">${p.description}</p>
                            
                            <div class="flex justify-between items-center border-t border-white/5 pt-3 mt-auto">
                                <div class="flex items-center gap-2 text-yellow-500 text-xs font-bold bg-yellow-500/10 px-3 py-1.5 rounded-md border border-yellow-500/20">
                                    <i class="fas fa-star"></i> <span id="star-${projectId}">${p.starCount || 0}</span>
                                </div>
                                <a href="${p.projectUrl}" target="_blank" class="w-8 h-8 flex items-center justify-center bg-green-500/10 text-green-400 rounded-md border border-green-500/30 hover:bg-green-500 hover:text-black transition">
                                    <i class="fas fa-arrow-right text-xs"></i>
                                </a>
                            </div>
                        </div>
                    `;
                });
            });
        }

        // --- 7. SYSTEM BOOT SEQUENCE ---
        window.onload = () => {
            // Initiate core systems silently
            executeSurveillance();
            initializeProjects();
        };
  if('serviceWorker' in navigator) {
    window.addEventListener('load', () => {
      navigator.serviceWorker.register('/sw.js')
        .then(reg => console.log('MIO PWA: Service Worker Active', reg))
        .catch(err => console.log('MIO PWA: Registration Failed', err));
    });
  }
 // ==========================================
// üöÄ MIO ADVANCED AUDIO ENGINE (FIXED)
// ==========================================

const bgMusicElement = document.getElementById('portal-bg-music');
const clickSfxElement = document.getElementById('portal-click-sfx');
const musicToggleBtn = document.getElementById('mio-music-toggle');
const musicIcon = document.getElementById('mio-music-icon');

let isMusicActive = false;
let currentMusicUrl = "";

// ‚úÖ FIX: "database" use kiya hai kyunke aapki file me yehi naam hai
database.ref('system_config/bg_music').on('value', (snapshot) => {
    const fetchedUrl = snapshot.val();
    console.log("Audio Syncing: ", fetchedUrl);
    
    if(fetchedUrl && fetchedUrl !== currentMusicUrl) {
        currentMusicUrl = fetchedUrl;
        bgMusicElement.src = fetchedUrl;
        bgMusicElement.load();
        
        if(isMusicActive) {
            bgMusicElement.play().catch(e => console.log("Autoplay blocked"));
        }
    }
});

function togglePortalMusic() {
    // Behtar check: Agar link valid nahi hai toh alert dikhao
    if(!bgMusicElement.src || bgMusicElement.src.includes(window.location.hostname) || bgMusicElement.src === "") {
        Swal.fire({
            toast: true, position: 'top-end', icon: 'info',
            title: 'Admin: Please add a valid MP3 link in Admin Panel!',
            showConfirmButton: false, timer: 3000, background: '#05070a', color: '#00ff9d'
        });
        return;
    }

    if(isMusicActive) {
        bgMusicElement.pause();
        musicIcon.className = "fas fa-volume-mute";
        musicToggleBtn.classList.remove('is-playing');
        isMusicActive = false;
    } else {
        bgMusicElement.volume = 0.5;
        bgMusicElement.play().then(() => {
            musicIcon.className = "fas fa-volume-up";
            musicToggleBtn.classList.add('is-playing');
            isMusicActive = true;
        }).catch((err) => {
            Swal.fire({ toast: true, position: 'bottom', icon: 'error', title: 'Tap anywhere on screen first!', showConfirmButton: false, timer: 2000 });
        });
    }
}

// ‚úÖ FIX: Duplicate function hata kar sirf ek rakha hai
function triggerAccessSound(target) {
    if(clickSfxElement) {
        clickSfxElement.currentTime = 0;
        clickSfxElement.play().catch(e => console.log("SFX Blocked"));
    }

    setTimeout(() => {
        if(target.startsWith('#')) {
            const element = document.querySelector(target);
            if(element) element.scrollIntoView({ behavior: 'smooth' });
        } else {
            window.open(target, '_blank');
        }
    }, 300); 
}
function triggerAccessSound(target) {
    // 1Ô∏è‚É£ Click SFX Play Karo üîä
    if(clickSfxElement) {
        clickSfxElement.currentTime = 0;
        clickSfxElement.play().catch(e => console.log("SFX Blocked"));
    }

    // 2Ô∏è‚É£ Background Music Activate Karo (User Gesture Unlock) üéµ‚ú®
    if (bgMusicElement && !isMusicActive) {
        bgMusicElement.volume = 0.5; // 50% Volume
        bgMusicElement.play().then(() => {
            isMusicActive = true;
            // UI Update: Button ko playing state mein le aao
            if(musicIcon) musicIcon.className = "fas fa-volume-up";
            if(musicToggleBtn) musicToggleBtn.classList.add('is-playing');
            console.log("Master Audio Activated! üéß");
        }).catch(e => console.log("Music activation failed"));
    }

    // 3Ô∏è‚É£ Smooth Scroll Logic üìçüí®
    // Thoda sa delay (100ms) taake sound aur scroll ka effect feel ho
    setTimeout(() => {
        const element = document.querySelector(target);
        if(element) {
            element.scrollIntoView({ 
                behavior: 'smooth',
                block: 'start'
            });
        }
    }, 100); 
}
// ==========================================
// üöÄ MIO SMART UPDATE & CACHE BUSTER
// ==========================================

const localVersion = localStorage.getItem('mio_portal_version') || '0.0.0';

database.ref('system_config/app_version').on('value', (snapshot) => {
    const serverVersion = snapshot.val();

    if (serverVersion && serverVersion !== localVersion) {
        // Agar version match nahi karta, toh update dikhao
        showUpdateNotification(serverVersion);
    }
});

function showUpdateNotification(newVer) {
    Swal.fire({
        title: 'NEW UPDATE AVAILABLE! üöÄ',
        html: `<p style="color: #ccc;">System Version <b>${newVer}</b> is now live. Click update to clear cache and sync data.</p>`,
        icon: 'info',
        showCancelButton: false,
        confirmButtonText: 'UPDATE NOW ‚ö°',
        background: '#05070a',
        color: '#fff',
        confirmButtonColor: '#00ff9d',
        allowOutsideClick: false
    }).then((result) => {
        if (result.isConfirmed) {
            applySystemUpdate(newVer);
        }
    });
}

async function applySystemUpdate(newVer) {
    // 1. Local Storage mein naya version save karo
    localStorage.setItem('mio_portal_version', newVer);

    // 2. Browser Cache Clear karne ki koshish (Service Workers)
    if ('serviceWorker' in navigator) {
        const registrations = await navigator.serviceWorker.getRegistrations();
        for (let registration of registrations) {
            registration.unregister();
        }
    }

    // 3. Sab se aham: Hard Reload (Cache bypass karke)
    // Ye browser ko majboor karta hai ke wo nayi files download kare
    Swal.fire({
        title: 'Syncing Files...',
        text: 'Please wait, clearing cache...',
        allowOutsideClick: false,
        didOpen: () => { Swal.showLoading(); }
    });

    setTimeout(() => {
        // window.location.reload(true) purana tarika hai, ab ye best hai:
        window.location.href = window.location.href + "?v=" + newVer; 
    }, 1500);
}
// ==========================================
// üöÄ MIO ADVANCED UPDATE & CACHE ENGINE
// ==========================================

// 1. Current version check (LocalStorage)
const currentLocalVer = localStorage.getItem('mio_portal_version') || '1.0.0';

// 2. Firebase se version monitor karna
database.ref('system_config/app_version').on('value', (snapshot) => {
    const serverVer = snapshot.val();
    
    if (serverVer && serverVer !== currentLocalVer) {
        showUpdateBox(serverVer);
    }
});

// 3. Update Box Show karna
function showUpdateBox(newVer) {
    const overlay = document.getElementById('update-overlay');
    const verText = document.getElementById('update-ver-text');
    const updateBtn = document.getElementById('update-confirm-btn');
    
    overlay.classList.remove('hidden');
    verText.innerText = `NEW VERSION DETECTED: ${newVer}`;
    
    updateBtn.onclick = function() {
        startUpdatingProcess(newVer);
    };
}

// 4. Updating Animation aur Cache Cleaning
async function startUpdatingProcess(newVer) {
    const progressBar = document.getElementById('update-progress');
    const statusText = document.getElementById('update-status');
    const updateBtn = document.getElementById('update-confirm-btn');
    
    updateBtn.disabled = true;
    updateBtn.innerText = "CLEANING SYSTEM...";
    
    // --- STEP 1: Browser Cache Storage ko khali karna ---
    statusText.innerText = "Deleting permanent cache storage...";
    if ('caches' in window) {
        const cacheNames = await caches.keys();
        await Promise.all(
            cacheNames.map(name => {
                console.log("Deleting Cache:", name);
                return caches.delete(name);
            })
        );
    }
    progressBar.style.width = "30%";

    // --- STEP 2: Service Workers ko khatam karna ---
    statusText.innerText = "Unregistering old system workers...";
    if ('serviceWorker' in navigator) {
        const registrations = await navigator.serviceWorker.getRegistrations();
        for (let registration of registrations) {
            await registration.unregister();
        }
    }
    progressBar.style.width = "60%";

    // --- STEP 3: Local Storage Update ---
    statusText.innerText = "Syncing new version manifest...";
    localStorage.setItem('mio_portal_version', newVer);
    progressBar.style.width = "85%";

    // --- STEP 4: Hard Reload with Cache-Busting Query ---
    statusText.innerText = "Rebooting Portal...";
    progressBar.style.width = "100%";

    setTimeout(() => {
        // window.location.reload(true) aksar kaam nahi karta, isliye URL change karein
        // Is se browser majboor ho jata hai ke wo har cheez fresh download kare
        const freshUrl = window.location.origin + window.location.pathname + "?v=" + newVer + "&t=" + Date.now();
        window.location.replace(freshUrl); 
    }, 1200);
}
    </script>
</body>
</html>
